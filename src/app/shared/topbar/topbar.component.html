<nav class="navbar navbar-expand bg-white border-bottom fixed-top transition-all"
  [class.sidebar-expanded]="!sidebarCollapsed" [class.sidebar-collapsed]="sidebarCollapsed">

  <div class="container-fluid px-4">

    <!-- Toggle Sidebar -->
    <button class="btn btn-link text-dark me-3 border-0 p-1 rounded-circle hover-bg-light" (click)="toggleSidebar()"
      title="Alternar menú">
      <i class="fa-solid fa-bars fs-5"></i>
    </button>

    <!-- Título de Página -->
    <span class="navbar-brand mb-0 h1 fw-bold text-dark">LogosPOS</span>

    <!-- Acciones Derecha -->
    <ul class="navbar-nav ms-auto align-items-center gap-3">

      <!-- Notificaciones -->
      <li class="nav-item dropdown">
        <a class="nav-link position-relative p-2" href="#" role="button" data-bs-toggle="dropdown"
          (click)="toggleNotificaciones(); $event.preventDefault()">
          <i class="fa-solid fa-bell fs-5 text-secondary"></i>

          @if (contadorNotificaciones > 0) {
          <span
            class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger border border-light">
            {{ contadorNotificaciones }}
          </span>
          }
        </a>

        <!-- Dropdown Menu Notificaciones -->
        <div class="dropdown-menu dropdown-menu-end shadow-lg border-0 p-0" [class.show]="mostrarNotificaciones"
          style="width: 320px; max-height: 80vh; overflow: hidden;">

          <div class="d-flex align-items-center justify-content-between p-3 border-bottom bg-light">
            <h6 class="mb-0 fw-bold">Notificaciones</h6>
            @if (contadorNotificaciones > 0) {
            <button class="btn btn-sm btn-link text-decoration-none" (click)="marcarTodasNotificacionesLeidas()">
              <i class="fa-solid fa-check-double me-1"></i> Marcar leídas
            </button>
            }
          </div>

          <div class="list-group list-group-flush overflow-auto" style="max-height: 400px;">
            @if (notificaciones.length === 0) {
            <div class="p-4 text-center text-muted">
              <i class="fa-solid fa-bell-slash fa-2x mb-2 opacity-50"></i>
              <p class="mb-0 small">No tienes notificaciones nuevas</p>
            </div>
            } @else {
            @for (notif of notificaciones; track notif.id) {
            <a href="javascript:void(0)" class="list-group-item list-group-item-action p-3 border-bottom"
              [class.bg-light]="!notif.leida" (click)="marcarNotificacionLeida(notif, $event)">
              <div class="d-flex w-100 justify-content-between mb-1">
                <strong class="text-truncate me-2" style="max-width: 200px;">{{ notif.titulo }}</strong>
                <small class="text-muted">{{ obtenerTiempoRelativo(notif.fecha) }}</small>
              </div>
              <p class="mb-1 small text-secondary text-truncate">{{ notif.mensaje }}</p>
            </a>
            }
            }
          </div>

          @if (notificaciones.length > 0) {
          <div class="p-2 border-top bg-light text-center">
            <button class="btn btn-sm btn-link text-danger text-decoration-none" (click)="limpiarNotificaciones()">
              Limpiar todo
            </button>
          </div>
          }
        </div>
      </li>

      <!-- Perfil Usuario -->
      <li class="nav-item dropdown">
        <a class="nav-link d-flex align-items-center gap-2 p-1 rounded hover-bg-light" href="javascript:void(0)"
          (click)="irAPerfil()">
          <div
            class="avatar rounded-circle d-flex align-items-center justify-content-center text-white fw-bold shadow-sm"
            [style.width.px]="38" [style.height.px]="38" [style.background-color]="obtenerColorRol()">
            {{ obtenerIniciales() }}
          </div>
          <div class="d-none d-md-block text-start lh-1">
            <div class="fw-bold fs-6 text-dark">{{ usuario?.nombre }}</div>
            <small class="text-muted" style="font-size: 0.75rem;">{{ usuario?.rol?.nombre }}</small>
          </div>
        </a>
      </li>

    </ul>
  </div>
</nav>

<!-- Overlay para cerrar al hacer click fuera -->
@if (mostrarNotificaciones) {
<div class="position-fixed top-0 start-0 w-100 h-100" style="z-index: 1020;" (click)="mostrarNotificaciones = false">
</div>
}