<div class="container-fluid p-3 bg-light d-flex flex-column h-100 overflow-hidden">

    <!-- Header -->
    <header
        class="d-flex justify-content-between align-items-center mb-4 flex-shrink-0 bg-white p-3 rounded-4 shadow-sm border border-white">
        <div class="d-flex align-items-center gap-3">
            <a routerLink="/cuentas-pagar"
                class="btn btn-light btn-sm rounded-circle shadow-sm border p-2 d-flex align-items-center justify-content-center"
                style="width: 38px; height: 38px;">
                <i class="fa-solid fa-arrow-left"></i>
            </a>
            @if (cuenta) {
            <div>
                <h1 class="h5 fw-bold text-dark mb-0 text-uppercase tracking-wider">Detalle de Cuenta</h1>
                <p class="text-muted small mb-0">{{ cuenta.concepto }}</p>
            </div>
            }
        </div>

        @if (cuenta) {
        <span [class]="obtenerClaseEstado(cuenta.estado)">
            {{ cuenta.estado | uppercase }}
        </span>
        }
    </header>

    @if (isLoading) {
    <div class="d-flex justify-content-center align-items-center flex-grow-1">
        <div class="spinner-border text-primary" role="status"></div>
    </div>
    } @else if (cuenta) {
    <div class="row g-4 flex-grow-1 overflow-auto px-1 pb-4">

        <!-- Información General -->
        <div class="col-lg-4">
            <div class="d-flex flex-column gap-4">

                <!-- Card Proveedor -->
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                    <div class="card-body p-4">
                        <h6 class="text-uppercase small text-muted fw-bold mb-4 d-flex align-items-center gap-2">
                            <i class="fa-solid fa-truck text-primary"></i> Proveedor
                        </h6>
                        <div class="bg-primary bg-opacity-10 rounded-4 p-4 mb-3 text-center">
                            <i class="fa-solid fa-building-columns fs-1 text-primary mb-3"></i>
                            <h5 class="fw-bold text-dark mb-1">{{ cuenta.proveedor_nombre }}</h5>
                            @if (cuenta.numero_factura) {
                            <span class="badge bg-white text-primary border border-primary-subtle rounded-pill">Fact: {{
                                cuenta.numero_factura }}</span>
                            }
                        </div>
                        <div class="list-group list-group-flush small">
                            <div class="list-group-item bg-transparent d-flex justify-content-between border-0 px-0">
                                <span class="text-muted">Fecha Factura:</span>
                                <span class="fw-semibold">{{ formatearFecha(cuenta.fecha_factura) }}</span>
                            </div>
                            <div class="list-group-item bg-transparent d-flex justify-content-between border-0 px-0">
                                <span class="text-muted">Vencimiento:</span>
                                <span class="fw-semibold text-danger">{{ formatearFecha(cuenta.fecha_vencimiento)
                                    }}</span>
                            </div>
                            <div class="list-group-item bg-transparent d-flex justify-content-between border-0 px-0">
                                <span class="text-muted">Prioridad:</span>
                                <span class="badge bg-light text-dark border rounded-pill">{{ cuenta.prioridad |
                                    titlecase }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resumen Financiero -->
                <div class="card border-0 shadow-sm rounded-4 bg-dark text-white pt-2">
                    <div class="card-body p-4">
                        <h6 class="text-uppercase small text-white-50 fw-bold mb-4">Resumen de Cuenta</h6>

                        <div
                            class="d-flex justify-content-between mb-3 border-bottom border-white border-opacity-10 pb-2">
                            <span class="text-white-50 small">Total Deuda</span>
                            <span class="fw-bold fs-5">${{ cuenta.monto_total.toLocaleString() }}</span>
                        </div>

                        <div
                            class="d-flex justify-content-between mb-3 border-bottom border-white border-opacity-10 pb-2">
                            <span class="text-white-50 small">Total Pagado</span>
                            <span class="fw-bold text-success">${{ cuenta.monto_pagado.toLocaleString() }}</span>
                        </div>

                        <div class="d-flex justify-content-between align-items-end pt-2">
                            <div>
                                <span class="text-white-50 small d-block">Monto Pendiente</span>
                                <span class="h2 fw-bold text-danger mb-0">${{ cuenta.monto_pendiente.toLocaleString()
                                    }}</span>
                            </div>
                            <div class="text-end">
                                <span
                                    class="badge bg-danger bg-opacity-25 text-danger border border-danger border-opacity-25 rounded-pill px-3 py-2">
                                    {{ ((cuenta.monto_pagado / cuenta.monto_total) * 100).toFixed(0) }}% Cubierto
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                @if (cuenta.notas) {
                <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-body p-4">
                        <h6 class="text-uppercase small text-muted fw-bold mb-2">Observaciones</h6>
                        <p class="text-muted small mb-0 fst-italic">"{{ cuenta.notas }}"</p>
                    </div>
                </div>
                }
            </div>
        </div>

        <!-- Historial de Pagos -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm rounded-4 h-100 overflow-hidden">
                <div class="card-header bg-white p-4 border-0 d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 fw-bold d-flex align-items-center gap-2">
                        <i class="fa-solid fa-receipt text-primary"></i> Historial de Pagos
                    </h6>
                    <span class="badge bg-light text-muted border rounded-pill">{{ cuenta.pagos.length }}
                        registros</span>
                </div>

                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light text-secondary small text-uppercase fw-bold">
                                <tr>
                                    <th class="ps-4 py-3">Fecha de Pago</th>
                                    <th class="py-3">Método</th>
                                    <th class="py-3 text-end">Monto Pagado</th>
                                    <th class="py-3 ps-4">Referencia / Notas</th>
                                    <th class="text-end pe-4 py-3">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="border-top-0">
                                @for (pago of cuenta.pagos; track pago.id) {
                                <tr>
                                    <td class="ps-4">
                                        <div class="fw-bold text-dark">{{ formatearFecha(pago.fecha_pago) }}</div>
                                        <small class="text-muted">Registrado: {{ pago.created_at | date:'shortTime'
                                            }}</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-light text-dark border rounded-pill px-3">{{
                                            pago.metodo_pago }}</span>
                                    </td>
                                    <td class="text-end fw-bold text-success">
                                        ${{ pago.monto.toLocaleString() }}
                                    </td>
                                    <td class="ps-4">
                                        <div class="small text-dark text-truncate" style="max-width: 200px;"
                                            [title]="pago.referencia || 'Sin referencia'">
                                            {{ pago.referencia || 'N/A' }}
                                        </div>
                                        @if (pago.notas) {
                                        <div class="text-muted" style="font-size: 0.7rem;">{{ pago.notas }}</div>
                                        }
                                    </td>
                                    <td class="text-end pe-4">
                                        <button (click)="eliminarPago(pago)"
                                            class="btn btn-outline-danger btn-sm border-0 rounded-circle"
                                            title="Eliminar pago">
                                            <i class="fa-solid fa-trash-can"></i>
                                        </button>
                                    </td>
                                </tr>
                                } @empty {
                                <tr>
                                    <td colspan="5" class="text-center py-5">
                                        <div class="opacity-25 mb-3">
                                            <i class="fa-solid fa-money-bill-transfer fa-3x"></i>
                                        </div>
                                        <h6 class="fw-bold text-muted mb-1">No hay pagos registrados</h6>
                                        <p class="text-muted small">Registra un pago desde la pantalla anterior para
                                            verlo aquí.</p>
                                    </td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
    }
</div>