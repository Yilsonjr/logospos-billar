<!-- Modal de Cliente -->
<div class="modal-overlay" (click)="cerrarModal()">
  <div class="modal-card animate-modal" (click)="$event.stopPropagation()">

    <!-- HEADER -->
    <div class="modal-header bg-light border-bottom py-3 px-4 d-flex justify-content-between align-items-center">
      <div>
        <h5 class="fw-bold text-dark mb-0">
          <i class="fa-solid" [class.fa-pen-to-square]="editando" [class.fa-user-plus]="!editando"></i>
          {{ editando ? 'Editar Cliente' : 'Nuevo Cliente' }}
        </h5>
        <small class="text-muted d-block mt-1">
          {{ editando ? 'Actualiza los datos del cliente' : 'Registra un nuevo cliente en el sistema' }}
        </small>
      </div>
      <button class="btn btn-sm btn-icon btn-light rounded-circle shadow-sm hover-danger" (click)="cerrarModal()">
        <i class="fa-solid fa-xmark fs-5"></i>
      </button>
    </div>

    <!-- BODY -->
    <form [formGroup]="clienteForm" (ngSubmit)="guardarCliente()" class="modal-body p-4">

      <!-- Fila 1: Identificación y Contacto -->
      <div class="row g-3 mb-3">
        <div class="col-md-3">
          <label class="form-label small fw-bold text-muted text-uppercase mb-1">
            <i class="fa-solid fa-id-card me-1"></i>Cédula
          </label>
          <input type="text" formControlName="cedula" class="form-control form-control-sm" placeholder="000-0000000-0"
            [class.is-invalid]="tieneError('cedula')">
          <div class="form-text" style="font-size:0.68rem;">
            Persona natural (B02)
          </div>
        </div>
        <div class="col-md-3">
          <label class="form-label small fw-bold mb-1" style="color:#92400e;">
            <i class="fa-solid fa-building me-1"></i>RNC
            <span class="badge rounded-pill ms-1 fw-bold"
              style="background:#fef3c7;color:#92400e;border:1px solid #fcd34d;font-size:0.6rem;">
              B01
            </span>
          </label>
          <input type="text" formControlName="rnc" class="form-control form-control-sm" placeholder="1-33-33333-3"
            [class.is-invalid]="tieneError('rnc')">
          <div class="form-text" style="font-size:0.68rem;color:#92400e;">
            Empresa → Crédito Fiscal
          </div>
        </div>
        <div class="col-md-6">
          <label class="form-label small fw-bold text-muted text-uppercase mb-1">Nombre Completo <span
              class="text-danger">*</span></label>
          <input type="text" formControlName="nombre" class="form-control form-control-sm fw-bold"
            placeholder="Nombre Cliente o Razón Social" [class.is-invalid]="tieneError('nombre')">
          <div *ngIf="tieneError('nombre')" class="invalid-feedback">{{ getMensajeError('nombre') }}</div>
        </div>
      </div>

      <!-- Fila 2: Contacto -->
      <div class="row g-3 mb-3">
        <div class="col-md-4">
          <label class="form-label small fw-bold text-muted text-uppercase mb-1">Teléfono</label>
          <div class="input-group input-group-sm">
            <span class="input-group-text bg-light border-end-0"><i class="fa-solid fa-phone text-muted"></i></span>
            <input type="tel" formControlName="telefono" class="form-control border-start-0 ps-1"
              placeholder="(809) 000-0000" [class.is-invalid]="tieneError('telefono')">
          </div>
        </div>
        <div class="col-md-8">
          <label class="form-label small fw-bold text-muted text-uppercase mb-1">Dirección / Email</label>
          <div class="input-group input-group-sm">
            <span class="input-group-text bg-light border-end-0"><i
                class="fa-solid fa-location-dot text-muted"></i></span>
            <input type="text" formControlName="direccion" class="form-control border-start-0 ps-1 me-2"
              placeholder="Dirección física">

            <span class="input-group-text bg-light border-end-0"><i class="fa-solid fa-envelope text-muted"></i></span>
            <input type="email" formControlName="email" class="form-control border-start-0 ps-1"
              placeholder="correo@ejemplo.com" [class.is-invalid]="tieneError('email')">
          </div>
        </div>
      </div>

      <!-- Separador -->
      <div class="d-flex align-items-center my-3">
        <span class="badge bg-primary-subtle text-primary border border-primary-subtle rounded-pill px-3">Configuración
          Comercial</span>
        <hr class="flex-grow-1 ms-3 my-0">
      </div>

      <!-- Fila 3: Configuración -->
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label small fw-bold text-muted text-uppercase mb-1">Tipo Cliente <span
              class="text-danger">*</span></label>
          <select formControlName="tipo_cliente" class="form-select form-select-sm fw-bold text-dark"
            [class.is-invalid]="tieneError('tipo_cliente')">
            @for (tipo of tiposCliente; track tipo.valor) {
            <option [value]="tipo.valor">{{ tipo.etiqueta }}</option>
            }
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label small fw-bold text-muted text-uppercase mb-1">Límite Crédito</label>
          <div class="input-group input-group-sm">
            <span class="input-group-text fw-bold text-success border-end-0">$</span>
            <input type="number" formControlName="limite_credito"
              class="form-control fw-bold text-end border-start-0 ps-1" placeholder="0.00" min="0">
          </div>
        </div>
        <div class="col-md-2">
          <label class="form-label small fw-bold text-muted text-uppercase mb-1">Desc %</label>
          <div class="input-group input-group-sm">
            <input type="number" formControlName="descuento_porcentaje"
              class="form-control text-center fw-bold text-primary" placeholder="0" min="0" max="100">
            <span class="input-group-text border-start-0">%</span>
          </div>
        </div>

        <!-- Estado Switch -->
        <div class="col-md-3 d-flex align-items-end mb-1">
          <div
            class="form-check form-switch w-100 p-0 border rounded px-3 py-2 d-flex justify-content-between align-items-center"
            [class.bg-success-subtle]="clienteForm.get('activo')?.value"
            [class.border-success-subtle]="clienteForm.get('activo')?.value">
            <label class="form-check-label small fw-bold cursor-pointer" for="activoSwitch">
              {{ clienteForm.get('activo')?.value ? 'Activo' : 'Inactivo' }}
            </label>
            <input class="form-check-input ms-2 mt-0 cursor-pointer" type="checkbox" role="switch" id="activoSwitch"
              formControlName="activo">
          </div>
        </div>
      </div>

      <!-- Notas Collapsible (Opcional) -->
      <div class="mt-3">
        <a class="text-decoration-none small text-muted d-flex align-items-center cursor-pointer"
          (click)="mostrarNotas = !mostrarNotas" role="button">
          <i class="fa-regular fa-note-sticky me-1"></i> Agregar notas u observaciones (opcional)
          <i class="fa-solid ms-1" [class.fa-chevron-down]="!mostrarNotas" [class.fa-chevron-up]="mostrarNotas"
            style="font-size: 0.6rem"></i>
        </a>
        <div *ngIf="mostrarNotas" class="mt-2 animate-fade-in">
          <textarea formControlName="notas" class="form-control form-control-sm bg-light" rows="2"
            placeholder="Escribe aquí cualquier observación relevante sobre este cliente..."></textarea>
        </div>
      </div>

      <!-- Footer Actions -->
      <div class="modal-footer border-top-0 px-0 pb-0 pt-4 mt-2">
        <button type="button" class="btn btn-light fw-bold text-muted border" (click)="cerrarModal()"
          [disabled]="isLoading">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary fw-bold px-4 hover-lift"
          [disabled]="isLoading || clienteForm.invalid">
          <i *ngIf="isLoading" class="fa-solid fa-circle-notch fa-spin me-2"></i>
          <i *ngIf="!isLoading" class="fa-solid fa-check me-2"></i>
          {{ isLoading ? 'Guardando...' : (editando ? 'Guardar Cambios' : 'Crear Cliente') }}
        </button>
      </div>
    </form>

  </div>
</div>